{% extends 'findafountain/base.html' %}
{% load staticfiles %}

{% block titleblock %}Home{% endblock %}

{% block title %}
	<h1>Find a Fountain</h1>
    <p class="lead"><b>Created by The Thirsty Pythons</b></p>
{% endblock %}


{% block content %}

<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
<script type="text/javascript"></script>

<style>
 #map {
	   width: 700px;
	   height: 500px;
	 }

	 #floating-panel {
		position: absolute;
		top: 10px;
		left: 25%;
		z-index: 5;
		background-color: yellow;
		padding: 5px;
		border: 1px solid #999;
		text-align: center;
		font-family: 'Roboto','sans-serif';
		line-height: 30px;
		padding-left: 10px;
		background: #fff;
		padding: 5px;
		font-size: 14px;
		font-family: Arial;
		border: 1px solid #ccc;
		box-shadow: 0 2px 2px rgba(33, 33, 33, 0.4);
		display: none;
	 }

	 #right-panel {
		font-family: 'Roboto','sans-serif';
		font-size: 14px;
		line-height: 30px;
		background-color: white;
		width: 200px;
		height: 500px;
		float: right;
		overflow: hidden;
	 }
</style>

<div class = "gridtwo">	
	<div class = "left" style="width:400px">
		<h4><b>Found a Fountain?</b></h4>
		<b>Signup and submit via the <a href = "{% url 'contact' %}" > Submit </a> page.</b> </br>
		<img src = "{% static 'img/libraryfountain.jpg' %}" alt = "Image of Library Fountain" style ="width:300px;height:400px;"><br />
		<b>Fountain of the Week:</b>
		Congratulations to the Library 4th floor fountain.
		Voted: Most clean, Best stocked, and Easiest to Find
	</div>

	<div class = "center2">
		<b>Thirsty? You came to the right page! <br/> Click on any of the fountains to get directions or select another option below.</b> <br/>
		<br/>  
			
			<button type="button" class="btn btn-primary" alt="Show all" align="left">
				<b>Show all<b>
			</button> 

			<button type="button" class="btn btn-primary" alt="Show all" align="left">
				<b>Search by keyword:<b>  
			</button> 

			<button type="button" class="btn btn-primary" alt="Show all" align="left">
				<b>Show nearest<b>  
			</button> 

			<br/><br/>

			<div id="map">
			  <script type="text/javascript">
				var map, currentPosition, infoWindow, geoLocatorMarker, geoLocatorInfoWindow;

				var locations = [
				  ['Main Building', 55.872084,  -4.288222, 1],
				  ['Boyd Orr', 55.873504, -4.292795, 2]
				];

				function initMap() {

					  map = new google.maps.Map(document.getElementById('map'), {
					  zoom: 16,
					  styles: [
    {
        "featureType": "landscape.man_made",
        "elementType": "all",
        "stylers": [
            {
                "color": "#faf5ed"
            },
            {
                "lightness": "0"
            },
            {
                "gamma": "1"
            }
        ]
    },
    {
        "featureType": "poi.park",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#bae5a6"
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "all",
        "stylers": [
            {
                "weight": "1.00"
            },
            {
                "gamma": "1.8"
            },
            {
                "saturation": "0"
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "hue": "#ffb200"
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "lightness": "0"
            },
            {
                "gamma": "1"
            }
        ]
    },
    {
        "featureType": "transit.station.airport",
        "elementType": "all",
        "stylers": [
            {
                "hue": "#b000ff"
            },
            {
                "saturation": "23"
            },
            {
                "lightness": "-4"
            },
            {
                "gamma": "0.80"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "all",
        "stylers": [
            {
                "color": "#a0daf2"
            }
        ]
    }
],
					  center: new google.maps.LatLng(55.872084, -4.288222),
					  mapTypeId: google.maps.MapTypeId.ROADMAP
					  });

						var directionsService = new google.maps.DirectionsService();
						var directionsDisplay = new google.maps.DirectionsRenderer();
						directionsDisplay.setMap(map);

						geoLocatorInfoWindow = new google.maps.InfoWindow;
						// Try HTML5 geolocation.
							if (navigator.geolocation) {
								  navigator.geolocation.getCurrentPosition(function(position) {
									currentPosition = {
									  lat: position.coords.latitude,
									  lng: position.coords.longitude
									};

									geoLocatorMarker = new google.maps.Marker({
									position: new google.maps.LatLng(currentPosition),
									map: map,
								  });
									
									geoLocatorInfoWindow.setContent('You are here');
									geoLocatorInfoWindow.open(map, geoLocatorMarker);
									map.setCenter(currentPosition);

								}, function() {
								handleLocationError(true, infoWindow, map.getCenter());
								});
							} else {
							  // Browser doesn't support Geolocation
							  handleLocationError(false, infoWindow, map.getCenter());
						}

						// directions service objects
						//control = document.getElementById('floating-panel');
						
						//control.style.display = 'block';
					   // map.controls[google.maps.ControlPosition.TOP_CENTER].push(control);
					 

						// adds markers to the map 
						var marker, i;
						var infowindow = new google.maps.InfoWindow;
						for (i = 0; i < locations.length; i++) {  
							  marker = new google.maps.Marker({
								position: new google.maps.LatLng(locations[i][1], locations[i][2]),
								map: map,
								icon: markerSymbol('deepskyblue')
							  });

							  google.maps.event.addListener(marker, 'click', (function(marker, i) {
								return function() {
								  infowindow.setContent(locations[i][0]);
								  infowindow.open(map, marker);

								  var endPosition = locations[i]; 

									// current location to a fountain 
								  calcRoute(directionsService, directionsDisplay, endPosition);
								}
							  })(marker, i));
							}
				} 

			   // if geolocation disabled 
				function handleLocationError(browserHasGeolocation, geoLocatorInfoWindow, pos) {
					geoLocatorInfoWindow.setPosition(pos);
					geoLocatorInfoWindow.setContent(browserHasGeolocation ?
								  'Error: The Geolocation service failed.' :
								  'Error: Your browser doesn\'t support geolocation.'); 
					geoLocatorInfoWindow.open(map);
				}

				function calcRoute(directionsService, directionsDisplay, endPoint) {

					var lat1 = endPoint[1];
					var lng1 = endPoint[2];

					var request = {
						origin: new google.maps.LatLng(currentPosition),
						destination: new google.maps.LatLng(lat1,lng1),
						travelMode: 'WALKING'
					};
					
					directionsService.route(request, function (result, status) {
					if (status == 'OK') {
					directionsDisplay.setOptions({ preserveViewport: true });
					directionsDisplay.setDirections(result);
					} else {
					directionsDisplay.setOptions({ preserveViewport: true });
					}
						});
				}

				function markerSymbol(color) {
					return {
						path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z',
						fillColor: color,
						fillOpacity: 1,
						strokeColor: '#000',
						strokeWeight: 2,
						scale: 1
							};
				}

			  </script>

			 <script async defer
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALaN1AQdFvEnlLyNLdHUmYKSjX5C82B4I&callback=initMap">
			 </script>
		</div>
	</div>

	<div class="right">
		<a class="twitter-timeline" data-width="300" data-height="600" href="https://twitter.com/fountain_finder?ref_src=twsrc%5Etfw">Tweets by fountain_finder</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
	</div>

</div>

{% endblock %}